name: Extract Domains and Push to GitHub

on:
  push:
    branches:
      - main  # 或者你希望触发此流程的其他分支

jobs:
  extract-and-push:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the repository
      uses: actions/checkout@v3

    - name: Set up SSH keys
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan github.com >> ~/.ssh/known_hosts

    - name: Download the ADRules list file
      run: curl -sL https://raw.githubusercontent.com/Cats-Team/AdRules/main/adrules.list -o adrules.list

    - name: Extract domains and create domains.txt
      run: |
        grep -oP '(?<=DOMAIN-SUFFIX,)[^,]+' adrules.list > domains.txt

    - name: Commit and push to the repository
      run: |
        git config user.name "GitHub Action"
        git config user.email "github-action@users.noreply.github.com"
        git add domains.txt
        git commit -m "Update domains.txt with new list of domains"
        git push --set-upstream git@github.com:Mercury000/extract-domain.git main
